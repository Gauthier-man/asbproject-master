{% extends 'base.html.twig' %}

{% block title %}Mon espace
{% endblock %}

{% block body %}
	<div class="container mt-5">
		<a href="{{ path('app_account') }}" class="btn btn-secondary mb-4">← Retour à mon espace</a>
		<h2>Bonjour
			{{ app.user.prenom }}
			{{ app.user.nom }},</h2>

		{% if devis is empty %}
			<p>Vous n'avez pas encore de devis en cours.</p>
		{% else %}
			{% for d in devis %}
				<div
					class="card mt-4 p-4 shadow-sm">
					{# Message d’introduction en fonction du statut #}
					{% if d.status == 'en_cours' %}
						<h4 class="mb-3">Votre demande de devis a bien été reçue</h4>
						<p>Merci d’avoir soumis votre projet. Notre équipe va étudier votre demande et reviendra vers vous rapidement.</p>
					{% elseif d.status == 'accepte' %}
						<h4 class="mb-3">Votre devis a été accepté</h4>
						<p>Votre devis a été traité. Vous trouverez ci-dessous les informations que notre équipe vous a transmises.</p>
					{% elseif d.status == 'refuse' %}
						<h4 class="mb-3">Votre demande a été refusée</h4>
						<p>Votre demande a été étudiée, mais n’a malheureusement pas pu être acceptée. Plus de détails ci-dessous.</p>
					{% endif %}

					<hr>

					<h5>Détails de votre projet</h5>
					<ul class="list-unstyled">
						<li>
							<strong>Type de projet :</strong>
							{{ d.typeProjet }}</li>
						<li>
							<strong>Localisation :</strong>
							{{ d.localisation }}</li>
						<li>
							<strong>Surface approximative :</strong>
							{{ d.surface ?? 'Non précisé' }}</li>
						<li>
							<strong>Délai souhaité :</strong>
							{{ d.delai ?? 'Non précisé' }}</li>
						<li>
							<strong>Description :</strong>
							{{ d.description }}</li>
					</ul>

					<hr>

					<h5>Statut de votre demande</h5>
					{% if d.status == 'en_cours' %}
						<p>
							<span class="text-primary">En cours d’étude</span>
						</p>
						<small class="text-muted">Votre demande est en cours de traitement.</small>
					{% elseif d.status == 'accepte' %}
						<p>
							<span class="text-success">Votre devis a été accepté ✅</span>
						</p>

						{% if d.estimatedPrice %}
							<p>
								<strong>Prix estimé :</strong>
								{{ d.estimatedPrice }}
								€</p>
						{% endif %}

						{% if d.adminNote %}
							<p>
								<strong>Message :</strong>
								{{ d.adminNote }}</p>
						{% endif %}

					{% elseif d.status == 'refuse' %}
						<p>
							<span class="text-danger">Votre demande a été refusée ❌</span>
						</p>

						{% if d.adminNote %}
							<p>
								<strong>Message :</strong>
								{{ d.adminNote }}</p>
						{% endif %}
					{% else %}
						<p>
							<span class="text-muted">Statut inconnu</span>
						</p>
					{% endif %}

				</div>

			{% endfor %}

		{% endif %}

	</div>
{% endblock %}
